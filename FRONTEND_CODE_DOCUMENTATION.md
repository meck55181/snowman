# 프론트엔드 코드 설명 문서

## 프로젝트 개요

이 프로젝트는 **Next.js 14** 기반의 React 애플리케이션으로, "연말정산"이라는 주제로 사용자들이 올해를 돌아보고 공유하는 웹 애플리케이션입니다. **TypeScript**, **Tailwind CSS**를 사용하여 구현되었습니다.

---

## 기술 스택

- **Framework**: Next.js 14.2.5 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **State Management**: React Hooks (useState, useEffect, useMemo)
- **Backend**: Supabase (API Routes를 통해 접근)

---

## 프로젝트 구조

```
app/
├── layout.tsx          # 루트 레이아웃 (메타데이터, 전역 스타일)
├── page.tsx            # 메인 페이지 (홈)
├── globals.css          # 전역 CSS 스타일
├── All/
│   └── page.tsx        # 모두의 결산 페이지 (네트워크 그래프)
├── My/
│   ├── page.tsx        # 나의 결산 페이지 (라우터)
│   └── SubmitForm.tsx  # 나의 결산 작성 폼
└── api/                # API 라우트 (서버 사이드)
    ├── All/
    │   └── route.ts
    └── My/
        └── route.ts
```

---

## 주요 페이지 및 컴포넌트

### 1. `app/layout.tsx` - 루트 레이아웃

**역할**: 전체 애플리케이션의 최상위 레이아웃 컴포넌트

**주요 기능**:
- HTML 메타데이터 설정 (title, description)
- 전역 CSS 파일 임포트 (`globals.css`)
- 모든 페이지에 공통으로 적용되는 구조 제공

**코드 구조**:
```typescript
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body className="antialiased">
        {children}
      </body>
    </html>
  );
}
```

---

### 2. `app/page.tsx` - 메인 페이지 (홈)

**역할**: 애플리케이션의 랜딩 페이지로, 스크롤 애니메이션과 인터랙티브한 카드 디자인을 제공

**주요 기능**:

#### 2.1 스크롤 기반 애니메이션
- **스크롤 위치 추적**: `scrollY` state로 현재 스크롤 위치를 추적
- **카드 이동**: PosterPage가 스크롤에 따라 위로 이동 (`posterPageOffset = scrollY * 1.2`)
- **페이드 아웃**: 
  - PosterPage: 스크롤 400px까지 서서히 사라짐
  - "scroll down" 텍스트: 스크롤 200px까지 사라짐

#### 2.2 반응형 스케일링
- 화면 크기에 따라 카드 크기 자동 조정:
  - 모바일 (< 640px): 최대 0.5배
  - 태블릿 (< 768px): 최대 0.7배
  - 데스크톱: 최대 0.85배
- 카드 크기: 612px × 792px 기준

#### 2.3 주요 컴포넌트

**DiagonalArrow**: 대각선 방향 화살표 컴포넌트
- 회전, 기울기(skew) 변환 지원
- 절대 위치 지정 가능

**VerticalArrow**: 세로 방향 화살표 컴포넌트
- 90도 회전된 화살표
- 절대 위치 지정 가능

#### 2.4 페이지 구조

1. **LinkerPage** (뒤쪽, 회색 카드)
   - 중앙 고정 (`fixed`, `top-1/2`, `left-1/2`)
   - 질문 플로우차트 표시 (YES/NO 분기)
   - "모두의 결산", "나의 결산" 링크 버튼

2. **PosterPage** (앞쪽, 연한 파란색 카드)
   - 스크롤 시 위로 이동하며 페이드 아웃
   - 트리 이미지와 로고
   - 3개의 특징 섹션:
     - "어디서든 괜찮아요" (집 아이콘)
     - "누구라도 괜찮아요" (사람 아이콘들)
     - "어떤 답변도 좋아요" (회전된 사람 아이콘)

3. **로고 및 네비게이션**
   - 상단 왼쪽에 고정된 로고 (점자 텍스트 포함)
   - 64px padding 적용

---

### 3. `app/All/page.tsx` - 모두의 결산 페이지

**역할**: 사용자들의 응답을 네트워크 그래프 형태로 시각화하고, 각 노드를 클릭하면 상세 정보를 모달로 표시

**주요 기능**:

#### 3.1 데이터 로딩
- **초기 로드**: 컴포넌트 마운트 시 `/api/All` 엔드포인트에서 최대 500개의 응답 데이터 로드
- **자동 새로고침**: 
  - 페이지 포커스 시 (`focus` 이벤트)
  - 페이지가 보일 때 (`visibilitychange` 이벤트)
- **에러 처리**: 로딩 실패 시 에러 메시지 표시

#### 3.2 네트워크 그래프 생성

**노드 생성**:
- 각 응답 데이터를 노드로 변환
- **LCG (Linear Congruential Generator)** 알고리즘을 사용한 결정적 랜덤 위치 생성
  - `pos_seed` 값을 시드로 사용
  - 동일한 시드는 항상 동일한 위치 생성 (일관성 보장)
- 뷰포트 크기: 1000px × 700px

**엣지(연결선) 생성**:
- 추천인 관계 기반 연결
- `recommender_insta`로 추천인 노드를 찾아 연결
- 추천인 → 작성자 방향으로 화살표 표시

**Asterisk 아이콘**:
- 추천 횟수에 따라 다른 아이콘 표시:
  - 1-2명: `asterisk_1.svg`
  - 3-4명: `asterisk_2.svg`
  - 5명 이상: `asterisk_3.svg`

#### 3.3 SVG 렌더링
- **연결선**: 반투명 흰색 선 (`rgba(255, 255, 255, 0.3)`)
- **노드**: 
  - Asterisk 아이콘 (클릭 가능)
  - 이름 텍스트 (아이콘 아래)
- **클릭 이벤트**: 노드 클릭 시 상세 정보 모달 열기

#### 3.4 상세 정보 모달 (Popup)

**디자인**: Figma 디자인에 맞춘 질문 카드 형식

**구조**:
1. **질문 1**: 올해의 나를 대표하는 낱말은?
   - 번호 박스 (1) + 질문 박스 (회색 배경)
   - 낱말 답변 박스 (토글 버튼 포함)
   - 낱말 스토리 답변 박스 (토글로 표시/숨김)

2. **질문 2**: 올해 가장 기억에 장면 하나는?
   - 번호 박스 (2) + 질문 박스
   - 답변 박스 (단일)

3. **질문 3**: 올해 내가 살았던 도시에게 하고 싶은 말은?
   - 번호 박스 (3) + 질문 박스
   - 도시 답변 박스 (토글 버튼)
   - 도시에게 하고 싶은 말 답변 박스 (토글)

4. **모두에게 하고 싶은 말**
   - 노란색 배경 (`#f7e982`)

5. **엔딩송**
   - 하단에 별도 표시

**토글 기능**:
- 질문 1과 질문 3에 토글 버튼
- 클릭 시 아래 답변 박스 표시/숨김
- 토글 아이콘이 시계 반대 방향으로 90도 회전

**모달 제어**:
- ESC 키로 닫기
- 배경 클릭으로 닫기
- X 버튼으로 닫기

#### 3.5 레이아웃
- 전체 화면 (`h-screen`)
- 어두운 배경 (`bg-[#181818]`)
- 64px padding 적용
- 상단 왼쪽에 "이전으로" 링크와 로고
- 하단 오른쪽에 범례 (asterisk 아이콘 설명)

---

### 4. `app/My/SubmitForm.tsx` - 나의 결산 작성 폼

**역할**: 사용자가 자신의 연말정산을 작성하고 제출하는 폼

**주요 기능**:

#### 4.1 폼 상태 관리
- 각 입력 필드별로 개별 state 관리:
  - `name`, `insta`, `recommenderInsta`
  - `q1Word`, `q1Story` (올해를 대표하는 낱말)
  - `q2Memory` (기억에 남는 장면)
  - `q3City`, `q3Message` (도시 관련)
  - `q4EndingSong` (엔딩송, 선택사항)
  - `q5FinalMessage` (모두에게 하고 싶은 말)

#### 4.2 폼 검증
- 모든 필수 필드 입력 확인
- 공백 제거 후 검증 (`trim()`)
- 에러 메시지 표시

#### 4.3 제출 처리
- `/api/My` 엔드포인트로 POST 요청
- 성공 시 `/All` 페이지로 리다이렉트 (`window.location.href`)
- 로딩 상태 표시 ("제출 중...")

#### 4.4 반응형 디자인
- 모바일/데스크톱에 따라 크기 조정
- Tailwind의 `sm:` 브레이크포인트 사용
- 입력 필드 높이, 폰트 크기, 패딩 등 반응형 적용

#### 4.5 레이아웃
- 64px padding 적용
- 상단에 "이전으로" 링크
- 로고 (나의결산)
- 중앙 정렬된 폼 카드
- 폼 카드 너비: 모바일 `calc(100%-128px)`, 데스크톱 `596px`

---

### 5. `app/My/page.tsx` - 나의 결산 페이지 라우터

**역할**: URL 쿼리 파라미터에서 추천인 정보를 추출하여 `SubmitForm`에 전달

**주요 기능**:
- `searchParams.ref`에서 추천인 인스타그램 핸들 추출
- `SubmitForm` 컴포넌트에 `initialRef` prop으로 전달
- Suspense로 로딩 상태 처리

---

### 6. `app/globals.css` - 전역 스타일

**주요 내용**:

#### 6.1 폰트 임포트
- **Pretendard**: 한국어 최적화 폰트 (CDN)
- **Noto Sans Symbols 2**: 점자 텍스트용 폰트

#### 6.2 Tailwind CSS 설정
- `@tailwind base`, `@tailwind components`, `@tailwind utilities`

#### 6.3 커스텀 스타일
- **점자 폰트 클래스**: `.braille`
- **깜빡임 애니메이션**: `.animate-blink`
- **기본 스타일**: body, a, button 태그 스타일

---

## 공통 패턴 및 특징

### 1. 스타일링 접근 방식
- **Tailwind CSS**: 유틸리티 퍼스트 방식
- **인라인 스타일**: 동적 값이 필요한 경우 (예: transform, opacity)
- **절대 위치 지정**: 픽셀 단위 정밀 배치 (`absolute`, `fixed`)

### 2. 상태 관리
- **로컬 State**: `useState`로 컴포넌트 내부 상태 관리
- **메모이제이션**: `useMemo`로 계산 비용이 큰 값 최적화
- **부수 효과**: `useEffect`로 라이프사이클 관리

### 3. 반응형 디자인
- **모바일 퍼스트**: 기본 스타일은 모바일 기준
- **브레이크포인트**: `sm:` (640px 이상) 사용
- **조건부 렌더링**: 화면 크기에 따른 다른 레이아웃

### 4. 접근성
- **점자 텍스트**: 시각 장애인을 위한 점자 표기
- **이미지 alt 텍스트**: 모든 이미지에 설명 제공
- **키보드 네비게이션**: ESC 키로 모달 닫기

### 5. 성능 최적화
- **메모이제이션**: 스타일 객체와 계산 값 메모이제이션
- **조건부 렌더링**: 불필요한 렌더링 방지
- **이벤트 리스너 정리**: `useEffect` cleanup 함수로 메모리 누수 방지

---

## 주요 상수 및 설정

### 카드 크기
- `CARD_WIDTH = 612px`
- `CARD_HEIGHT = 792px`

### 뷰포트 크기 (All 페이지)
- `VIEW_WIDTH = 1000px`
- `VIEW_HEIGHT = 700px`

### 폰트
- `FONT_FAMILY = "'Pretendard', 'Noto Sans Symbols 2', sans-serif"`

### 색상
- 배경: `#eee` (연한 회색), `#181818` (어두운 회색), `#95acac` (연한 청록색)
- 강조: `#f7e982` (노란색)
- 테두리: `black`

---

## 데이터 흐름

### 1. 데이터 로딩
```
사용자 액션 → API 호출 → 상태 업데이트 → UI 렌더링
```

### 2. 폼 제출
```
사용자 입력 → 검증 → API POST 요청 → 성공 시 리다이렉트
```

### 3. 네트워크 그래프
```
API 데이터 → 노드/엣지 계산 (useMemo) → SVG 렌더링
```

---

## 주의사항 및 개선 가능한 부분

1. **에러 처리**: 일부 API 호출에서 에러 처리가 간단함
2. **로딩 상태**: All 페이지에서 개별 노드 로딩 시 전체 UI가 블로킹될 수 있음
3. **성능**: 많은 노드가 있을 때 SVG 렌더링 성능 최적화 필요
4. **접근성**: 키보드 네비게이션 개선 여지
5. **타입 안정성**: 일부 `as any` 타입 단언 사용

---

## 주요 의존성

- `next`: Next.js 프레임워크
- `react`, `react-dom`: React 라이브러리
- `@supabase/supabase-js`: Supabase 클라이언트 (백엔드 통신)
- `tailwindcss`: 유틸리티 CSS 프레임워크
- `typescript`: 타입 안정성

---

이 문서는 프로젝트의 프론트엔드 코드 구조와 주요 기능을 설명합니다. 각 컴포넌트의 세부 구현은 소스 코드를 참고하시기 바랍니다.






